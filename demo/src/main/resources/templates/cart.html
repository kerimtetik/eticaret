<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gözlük Dünyası - Sepetim</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .cart-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>

<header class="bg-light p-3">
    <div class="container">
        <h1 class="text-center">Sepetim</h1>
        <div class="text-center">
            <p th:if="${session.loggedInUser != null}">
                Hoş geldiniz, <strong th:text="${session.loggedInUser.username}"></strong>
                <a class="btn btn-danger btn-sm" href="/logout">Çıkış Yap</a>
            </p>
            <p th:if="${session.loggedInUser == null}">
                Giriş yapmadınız. <a href="/login" class="btn btn-primary">Giriş Yap</a>
            </p>
        </div>
    </div>
</header>

<div class="container mt-4">
    <h2 class="text-center">Sepetinizdeki Ürünler</h2>
    
    <div th:if="${cartItems != null and not cartItems.isEmpty()}">
        <ul class="list-group">
            <li th:each="item : ${cartItems}" class="list-group-item cart-item">
                <div class="d-flex justify-content-between">
                    <div>
                        <strong th:text="${item.product.name}"></strong><br>
                        <strong th:text="${item.product.product_code}">Ürün Kodu</strong><br>
                        <strong th:text="${item.product.polarized}">Polarize</strong><br>
                        <strong th:text="${item.product.price}">Fiyat</strong>₺ <br>
                        <strong th:text="${item.product.gender}">Cinsiyet</strong><br>
                        <img th:if="${item.product.imageUrl != null}" 
						     th:src="@{${item.product.imageUrl}}" 
						     alt="Ürün Resmi" width="150">
						
						<p th:if="${item.product.imageUrl == null}">Görsel mevcut değil</p>
                    </div>
                    <div>
                        <input type="number" th:value="${item.quantity}" min="1"
                               onchange="updateQuantity([[${item.id}]], this.value)" class="form-control w-50">
                        <button class="btn btn-danger btn-sm mt-2"
                                onclick="removeItem([[${item.id}]])">Sil</button>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <div th:if="${cartItems == null or cartItems.isEmpty()}">
        <p class="text-center">Sepetinizde ürün bulunmamaktadır.</p>
    </div>

    <div class="text-center mt-4">
        <button class="btn btn-success" onclick="goToCheckout()">Ödeme Yap</button>
    </div>
</div>

<script>
    function updateQuantity(itemId, quantity) {
        fetch(`/cart/update?cartItemId=${itemId}&quantity=${quantity}`, { method: 'POST' })
            .then(response => {
                if (response.ok) {
                    alert('Sepet güncellendi!');
                    location.reload();
                } else {
                    alert('Güncelleme başarısız!');
                }
            });
    }

    function removeItem(itemId) {
        fetch(`/cart/remove?cartItemId=${itemId}`, { method: 'POST' })
            .then(() => location.reload());
    }

    function goToCheckout() {
        window.location.href = "/checkout";
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
